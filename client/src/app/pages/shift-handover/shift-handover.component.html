<div class="passagem-page" style="min-height: 100vh; display: flex; flex-direction: column; background: var(--neutral-light);">
  <!-- Header -->
  <header class="module-header bg-white" style="box-shadow: var(--shadow); padding: 16px 0; margin-bottom: 0; border-bottom: 3px solid var(--primary-blue);">
    <div class="container mx-auto px-5">
      <div class="header-top flex justify-between items-center w-full mb-4">
        <div class="header-left flex items-center gap-5">
          <button class="menu-toggle p-2 rounded-md transition-all" (click)="goToModules()">
            <span style="font-size: 24px; color: var(--primary-blue);">‚ò∞</span>
          </button>
          <img 
            src="https://11care.com.br/wp-content/uploads/2024/05/logo-11Care-azul-1024x249.png.webp"
            alt="11Care"
            class="h-11 hidden sm:block"
          />
        </div>
        
        <div class="page-info flex items-center justify-center gap-5 flex-1">
          <div class="text-center">
            <h1 class="text-[22px] font-bold m-0" style="color: var(--primary-blue);">
              Passagem de Plant√£o (SBAR)
            </h1>
            <p class="text-sm m-0" style="color: var(--neutral-gray);">
              UNIDADE: 10 A - DAR | ENFERMEIRO: ANDRESSA / LIDIA / GUSTAVO
            </p>
          </div>
        </div>
        
        <div class="header-right flex items-center gap-4">
          <button 
            class="icon-btn p-2 rounded-md transition-all"
            (click)="refresh()"
            (mouseenter)="onIconHover($event, true)"
            (mouseleave)="onIconHover($event, false)"
            data-testid="button-sync"
            title="Atualizar"
          >
            <span style="font-size: 20px; color: var(--neutral-gray);">‚Üª</span>
          </button>
          <button 
            class="icon-btn p-2 rounded-md transition-all relative"
            (click)="toggleAlerts()"
            (mouseenter)="onIconHover($event, true)"
            (mouseleave)="onIconHover($event, false)"
            data-testid="button-alerts"
            title="Alertas"
          >
            <span style="font-size: 20px; color: var(--neutral-gray);">üîî</span>
            <span 
              *ngIf="alerts.length > 0" 
              class="alert-badge absolute top-0 right-0 rounded-full flex items-center justify-center text-xs font-bold"
              style="background: var(--accent-red); color: white; width: 18px; height: 18px;"
            >
              {{ alerts.length }}
            </span>
          </button>
          <button 
            class="btn btn-success hidden sm:inline-flex"
            data-testid="button-print"
          >
            Imprimir
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Breadcrumb -->
  <div class="breadcrumb bg-white py-4" style="border-bottom: 1px solid var(--border-gray); margin-bottom: 20px;">
    <div class="container mx-auto px-5">
      <div class="breadcrumb-content flex items-center gap-2 text-sm" style="color: var(--neutral-gray);">
        <button 
          (click)="goToModules()"
          class="hover:underline transition-colors"
          style="color: var(--primary-blue);"
          data-testid="link-home"
        >
          In√≠cio
        </button>
        <span>/</span>
        <button 
          (click)="goToModules()"
          class="hover:underline transition-colors"
          style="color: var(--primary-blue);"
          data-testid="link-modules"
        >
          M√≥dulos
        </button>
        <span>/</span>
        <span>Passagem de Plant√£o</span>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="dashboard-container flex-1 container mx-auto px-5">
    <!-- Status Overview -->
    <div class="status-overview grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
      <div 
        class="status-card complete rounded-xl text-center transition-transform"
        style="background: linear-gradient(135deg, white 0%, #f0fff4 100%); border-top: 4px solid var(--accent-green); box-shadow: var(--shadow); padding: 16px; height: 100px; display: flex; flex-direction: column; justify-content: center;"
      >
        <div class="status-count text-3xl font-extrabold mb-1" style="color: var(--accent-green);" data-testid="stat-complete">
          {{ stats.complete }}
        </div>
        <div class="status-label text-sm font-semibold" style="color: var(--neutral-gray);">Completos</div>
      </div>
      
      <div 
        class="status-card pending rounded-xl text-center transition-transform"
        style="background: linear-gradient(135deg, white 0%, #fffaf0 100%); border-top: 4px solid var(--accent-orange); box-shadow: var(--shadow); padding: 16px; height: 100px; display: flex; flex-direction: column; justify-content: center;"
      >
        <div class="status-count text-3xl font-extrabold mb-1" style="color: var(--accent-orange);" data-testid="stat-pending">
          {{ stats.pending }}
        </div>
        <div class="status-label text-sm font-semibold" style="color: var(--neutral-gray);">Pendentes</div>
      </div>
      
      <div 
        class="status-card alert rounded-xl text-center transition-transform"
        style="background: linear-gradient(135deg, white 0%, #fffdf0 100%); border-top: 4px solid var(--accent-yellow); box-shadow: var(--shadow); padding: 16px; height: 100px; display: flex; flex-direction: column; justify-content: center;"
      >
        <div class="status-count text-3xl font-extrabold mb-1" style="color: var(--accent-yellow);" data-testid="stat-alert">
          {{ stats.alert }}
        </div>
        <div class="status-label text-sm font-semibold" style="color: var(--neutral-gray);">Com Alertas</div>
      </div>
      
      <div 
        class="status-card critical rounded-xl text-center transition-transform"
        style="background: linear-gradient(135deg, white 0%, #fff0f0 100%); border-top: 4px solid var(--accent-red); box-shadow: var(--shadow); padding: 16px; height: 100px; display: flex; flex-direction: column; justify-content: center;"
      >
        <div class="status-count text-3xl font-extrabold mb-1" style="color: var(--accent-red);" data-testid="stat-critical">
          {{ stats.critical }}
        </div>
        <div class="status-label text-sm font-semibold" style="color: var(--neutral-gray);">Cr√≠ticos</div>
      </div>
      
      <div 
        class="status-card rounded-xl text-center transition-transform"
        style="background: linear-gradient(135deg, white 0%, var(--light-blue) 100%); border-top: 4px solid var(--primary-blue); box-shadow: var(--shadow); padding: 16px; height: 100px; display: flex; flex-direction: column; justify-content: center;"
      >
        <div class="status-count text-3xl font-extrabold mb-1" style="color: var(--primary-blue);" data-testid="stat-total">
          {{ stats.total }}
        </div>
        <div class="status-label text-sm font-semibold" style="color: var(--neutral-gray);">Total de Pacientes</div>
      </div>
    </div>

    <!-- Search and Legend -->
    <div class="mb-4 space-y-3">
      <div class="relative">
        <input
          type="search"
          placeholder="Buscar por paciente, leito ou especialidade..."
          [(ngModel)]="searchTerm"
          class="w-full px-4 py-3 pl-12 rounded-lg transition-all bg-white text-base"
          style="border: 2px solid var(--border-gray);"
          (focus)="onSearchFocus($event)"
          (blur)="onSearchBlur($event)"
          data-testid="input-search"
        />
        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xl" style="color: var(--neutral-gray);">üîç</span>
      </div>
      
      <div class="rounded-lg p-3" style="background: var(--neutral-light);">
        <div class="flex items-center gap-6 text-xs flex-wrap">
          <div class="font-semibold" style="color: var(--text-gray);">Legenda - Mobilidade:</div>
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 rounded text-xs font-mono" style="background: var(--border-gray);">A</span>
            <span style="color: var(--text-gray);">Acamado</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 rounded text-xs font-mono" style="background: var(--border-gray);">D</span>
            <span style="color: var(--text-gray);">Deambula</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 rounded text-xs font-mono" style="background: var(--border-gray);">DA</span>
            <span style="color: var(--text-gray);">Deambula Com Aux√≠lio</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="bg-white rounded-xl shadow-md p-12 flex items-center justify-center">
      <div class="text-xl font-semibold" style="color: var(--primary-blue);">Carregando...</div>
    </div>

    <!-- Patients Table -->
    <div *ngIf="!isLoading" class="planilha-grid bg-white rounded-xl overflow-hidden mb-10" style="box-shadow: var(--shadow); border: 1px solid var(--border-gray); width: 100%;">
      <div class="overflow-x-auto">
        <table class="w-full text-xs border-collapse">
          <thead style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%); color: white;">
            <tr>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap sticky left-0 z-20" style="background: var(--primary-blue);">LEITO</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[100px]">ESPECIALIDADE/<br/>RAMAL</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[180px]">NOME/<br/>REGISTRO/<br/>DATA DE NASCIMENTO</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[90px]">DATA DE<br/>INTERNA√á√ÉO</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[70px]">RQ BRADEN<br/>SCP</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[140px]">DIAGN√ìSTICO/<br/>COMORBIDADES</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[90px]">ALERGIAS</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[80px]">MOBILIDADE</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[120px]">DIETA</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[90px]">ELIMINA√á√ïES</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[110px]">DISPOSITIVOS</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[100px]">ATB</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[100px]">CURATIVOS</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[100px]">APORTE<br/>E SA√çDA</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[140px]">EXAMES<br/>REALIZADOS/<br/>PENDENTES</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[120px]">DATA DA<br/>PROGRAMA√á√ÉO<br/>CIR√öRGICA</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[180px]">OBSERVA√á√ïES/<br/>INTERCORR√äNCIAS</th>
              <th class="px-2 py-3 text-center font-semibold text-[11px] border border-blue-700 whitespace-nowrap min-w-[100px]">PREVIS√ÉO<br/>DE ALTA</th>
            </tr>
          </thead>
          <tbody>
            <tr 
              *ngFor="let patient of filteredPatients; let i = index"
              [ngClass]="getRowClass(patient, i)"
              [attr.data-testid]="'row-patient-' + patient.id"
              class="transition-colors"
            >
              <td class="px-2 py-2 text-center font-bold border sticky left-0 bg-inherit z-10" style="color: var(--primary-blue); border-color: var(--border-gray);">
                {{ patient.leito }}
              </td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.especialidadeRamal || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">
                <div class="font-semibold">{{ patient.nome }}</div>
                <div style="color: var(--neutral-gray);">{{ patient.registro || '-' }}</div>
                <div style="color: var(--neutral-gray);">{{ patient.dataNascimento || '-' }}</div>
              </td>
              <td class="px-2 py-2 text-[11px] text-center border" style="border-color: var(--border-gray);">{{ patient.dataInternacao || '-' }}</td>
              <td class="px-2 py-2 text-[11px] text-center border" style="border-color: var(--border-gray);">{{ patient.rqBradenScp || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.diagnosticoComorbidades || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.alergias || '-' }}</td>
              <td class="px-2 py-2 text-[11px] text-center border" style="border-color: var(--border-gray);">{{ patient.mobilidade || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.dieta || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.eliminacoes || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.dispositivos || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.atb || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.curativos || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.aporteSaida || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.examesRealizadosPendentes || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.dataProgramacaoCirurgica || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.observacoesIntercorrencias || '-' }}</td>
              <td class="px-2 py-2 text-[11px] border" style="border-color: var(--border-gray);">{{ patient.previsaoAlta || '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Alerts Sidebar -->
  <div 
    *ngIf="alertsOpen" 
    class="alert-sidebar fixed top-0 h-screen bg-white shadow-2xl transition-all flex flex-col"
    [ngClass]="{'open': alertsOpen}"
    style="right: 0; width: 400px; z-index: 1000; box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);"
  >
    <div class="alert-header flex justify-between items-center p-5" style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%); color: white;">
      <h3 class="text-lg font-bold">Alertas do Sistema</h3>
      <button (click)="toggleAlerts()" class="text-white text-2xl hover:opacity-80 transition-opacity" style="background: none; border: none; cursor: pointer;">
        ‚úï
      </button>
    </div>
    
    <div class="alert-content flex-1 overflow-y-auto p-5">
      <div 
        *ngFor="let alert of alerts"
        class="alert-item p-4 rounded-lg mb-3"
        [ngClass]="{
          'critical': alert.priority === 'critical',
          'medium': alert.priority === 'medium'
        }"
        [attr.data-testid]="'alert-' + alert.id"
        style="border-left: 4px solid var(--accent-yellow); background: linear-gradient(135deg, #fffdf0 0%, white 100%); border: 1px solid #ffeaa7;"
      >
        <span 
          class="alert-priority inline-block px-2 py-1 rounded-xl text-xs font-bold mb-2"
          [style.background]="alert.priority === 'critical' ? 'var(--accent-red)' : alert.priority === 'medium' ? 'var(--accent-orange)' : 'var(--accent-yellow)'"
          [style.color]="alert.priority === 'low' ? 'var(--neutral-dark)' : 'white'"
        >
          {{ getPriorityLabel(alert.priority) }} PRIORIDADE
        </span>
        <div class="alert-info mb-2">
          <div class="font-semibold text-sm mb-1">Paciente: {{ alert.patientId }}</div>
          <p class="text-sm" style="color: var(--text-gray);">
            {{ alert.message }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Backdrop for sidebar -->
  <div 
    *ngIf="alertsOpen" 
    class="fixed inset-0 bg-black bg-opacity-30 z-40"
    (click)="toggleAlerts()"
  ></div>
</div>
